#!/bin/bash

#
# Author: Arkadiusz DziÄ™giel <arkadiusz.dziegiel@glorpen.pl>
#

function run_shutdownd()
{
	echo "## Running shutdown scripts ##"
	find /etc/docker-shutdown.d -type f -perm -u+x | sort | while read n;
	do
		echo "Executing ${n} ...";
		
		"${n}";
		
		ret=$?;
		if [ $ret -ne 0 ];
		then
			echo "Running ${n} failed with ${ret}, continuing";
		fi
	done
	
	echo "All scripts executed, exitting."
	exit 0;
}	

trap '{ run_shutdownd; }' TERM INT

# big sleep for sane PID
while true; do sleep 30d;done
